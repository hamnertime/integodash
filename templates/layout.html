{# templates/layout.html #}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integodash - {% block title %}{% endblock %}</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layouts.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gridstack@7.2.3/dist/gridstack.min.css" />
    {% block head %}{% endblock %}
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">Integodash</div>
            <button id="menu-toggle" class="icon-button">
                <svg viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
            </button>
        </div>
        <div class="nav-links">
            <div class="nav-links-top">
                {% if 'user_id' in session %}
                <a href="{{ url_for('clients.billing_dashboard') }}" class="{{ 'active' if request.endpoint == 'clients.billing_dashboard' else '' }}" title="Clients"><svg viewBox="0 0 24 24"><path d="M18,15H16V17H18M18,11H16V13H18M20,19H12V17H14V15H12V13H14V11H12V9H20M10,7H8V5H10M10,11H8V9H10M10,15H8V13H10M10,19H8V17H10M6,7H4V5H6M6,11H4V9H6M6,15H4V13H6M6,19H4V17H6M12,7V3H2V21H22V7H12Z"/></svg><span>Clients</span></a>
                {% if client and client.account_number %}
                    <a href="{{ url_for('clients.client_billing_details', account_number=client.account_number) }}" class="{{ 'active' if request.endpoint == 'clients.client_billing_details' else '' }}" title="Client Details"><svg viewBox="0 0 24 24"><path d="M14,2L20,8V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2H14M13,3.5V9H18.5L13,3.5M15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9A3,3 0 0,1 15,12M17,17.5L15.25,15.75C14.5,16.35 13.55,16.75 12.5,16.75C10.25,16.75 8.5,15 8.5,12.75C8.5,10.5 10.25,8.75 12.5,8.75C14.75,8.75 16.5,10.5 16.5,12.75C16.5,13.8 16.1,14.75 15.5,15.5L17.25,17.25L17,17.5Z"/></svg><span>Client Details</span></a>
                    <a href="{{ url_for('clients.client_settings', account_number=client.account_number) }}" class="{{ 'active' if request.endpoint == 'clients.client_settings' else '' }}" title="Client Settings"><svg viewBox="0 0 24 24"><path d="M22.7,19L13.6,9.9C14.5,7.6 14,4.9 12.1,3C10.1,1 7.1,0.6 4.7,1.7L9,6L6,9L1.6,4.7C0.4,7.1 0.9,10.1 2.9,12.1C4.8,14 7.5,14.5 9.8,13.6L18.9,22.7C19.3,23.1 19.9,23.1 20.3,22.7L22.6,20.4C23.1,20 23.1,19.3 22.7,19Z"/></svg><span>Client Settings</span></a>
                {% endif %}
                <a href="{{ url_for('assets.assets') }}" class="{{ 'active' if request.blueprint == 'assets' else '' }}" title="Assets"><svg viewBox="0 0 24 24"><path d="M4,6H20V16H4M20,18A2,2 0 0,0 22,16V6C22,4.89 21.1,4 20,4H4C2.89,4 2,4.89 2,6V16A2,2 0 0,0 4,18H0V20H24V18H20Z"/></svg><span>Assets</span></a>
                <a href="{{ url_for('contacts.contacts') }}" class="{{ 'active' if request.endpoint == 'contacts.contacts' else '' }}" title="Contacts"><svg viewBox="0 0 24 24"><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"/></svg><span>Contacts</span></a>
                {% if contact and contact.id %}
                    <a href="{{ url_for('contacts.contact_details', contact_id=contact.id) }}" class="{{ 'active' if request.endpoint == 'contacts.contact_details' else '' }}" title="Contact Details"><svg viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,6A3,3 0 0,1 15,9A3,3 0 0,1 12,12A3,3 0 0,1 9,9A3,3 0 0,1 12,6M12,14C14.67,14 17,15.33 17,17V18H7V17C7,15.33 9.33,14 12,14Z"/></svg><span>Contact Details</span></a>
                {% endif %}
                <a href="{{ url_for('kb.kb') }}" class="{{ 'active' if request.blueprint == 'kb' else '' }}" title="Knowledge Base"><svg viewBox="0 0 24 24"><path d="M19 2L14 6.5V17.5L19 13V2M6.5 5C4.55 5 2.45 5.4 1 6.5V21.16C1 21.41 1.25 21.66 1.5 21.66C1.6 21.66 1.65 21.59 1.75 21.59C3.1 20.94 5.05 20.5 6.5 20.5C8.45 20.5 10.55 20.9 12 22C13.35 21.15 15.8 20.5 17.5 20.5C19.15 20.5 20.85 20.81 22.25 21.56C22.35 21.61 22.4 21.59 22.5 21.59C22.75 21.59 23 21.34 23 21.09V6.5C22.4 6.05 21.75 5.75 21 5.5V19C19.9 18.65 18.7 18.5 17.5 18.5C15.8 18.5 13.35 19.15 12 20V6.5C10.55 5.4 8.45 5 6.5 5Z" /></svg><span>Knowledge Base</span></a>
                <a href="https://192.168.1.194:6969/helpdesk" target="_blank" title="Ticket Dashboard"><svg viewBox="0 0 24 24"><path d="M20,12A2,2 0 0,0 22,14V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V14C3.11,14 4,13.1 4,12A2,2 0 0,0 2,10V6C2,4.89 2.9,4 4,4H20A2,2 0 0,1 22,6V10A2,2 0 0,0 20,12M16.5,16.25C16.5,14.75 13.5,14 12,14C10.5,14 7.5,14.75 7.5,16.25V17H16.5V16.25M12,12.25A2.25,2.25 0 0,0 14.25,10A2.25,2.25 0 0,0 12,7.75A2.25,2.25 0 0,0 9.75,10A2.25,2.25 0 0,0 12,12.25Z"></path></svg><span>Ticket Dashboard</span></a>
                {% for link in custom_links %}
                    <a href="{{ link.url }}" target="_blank" title="{{ link.name }}">
                        <svg viewBox="0 0 24 24"><path d="M3.9,12C3.9,10.29 5.29,8.9 7,8.9H11V7H7A5,5 0 0,0 2,12A5,5 0 0,0 7,17H11V15.1H7C5.29,15.1 3.9,13.71 3.9,12M8,13H16V11H8V13M17,7H13V8.9H17C18.71,8.9 20.1,10.29 20.1,12C20.1,13.71 18.71,15.1 17,15.1H13V17H17A5,5 0 0,0 22,12A5,5 0 0,0 17,7Z" /></svg>
                        <span>{{ link.name }}</span>
                    </a>
                {% endfor %}
                {% endif %}
            </div>
            <div class="nav-links-bottom">
                {% if 'user_id' in session %}
                <a href="{{ url_for('settings.billing_settings') }}" class="{{ 'active' if request.blueprint == 'settings' else '' }}" title="Settings & Sync"><svg viewBox="0 0 24 24"><path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/></svg><span>Settings & Sync</span></a>
                <a href="#" id="widget-library-btn" class="button" title="Widget Library"><svg viewBox="0 0 24 24"><path d="M3,3H11V7.34L16.66,1.69L22.31,7.34L16.66,13H21V21H13V13H16.66L11,7.34V11H3V3M3,13H11V21H3V13Z"/></svg><span>Widget Library</span></a>
                <a href="{{ url_for('auth.logout') }}" title="Logout"><svg viewBox="0 0 24 24"><path d="M17 7L15.59 8.41L18.17 11H8V13H18.17L15.59 15.58L17 17L22 12M4 5H12V3H4C2.9 3 2 3.9 2 5V19C2 20.1 2.9 21 4 21H12V19H4V5Z"/></svg><span>Logout</span></a>
                {% endif %}
                <div class="theme-switch-wrapper">
                    <label class="theme-switch" for="checkbox">
                        <input type="checkbox" id="checkbox" />
                        <div class="slider round"></div>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div id="widgetLibraryModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Widget Library</h2>
                    <span class="close-button">&times;</span>
                </div>
                <div id="widget-library-list">
                    </div>
            </div>
        </div>

        <div class="container">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            {% block content %}{% endblock %}
        </div>
    </div>

    {% block scripts %}
    <script src="https://cdn.jsdelivr.net/npm/gridstack@7.2.3/dist/gridstack-all.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/widget_library.js') }}"></script>
    <script src="{{ url_for('static', filename='js/table_resizer.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
            const currentTheme = localStorage.getItem('theme');

            if (currentTheme) {
                document.body.classList.add(currentTheme);

                if (currentTheme === 'dark-mode') {
                    toggleSwitch.checked = true;
                }
            } else {
                // Default to dark mode if no theme is set
                document.body.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark-mode');
                toggleSwitch.checked = true;
            }

            function switchTheme(e) {
                if (e.target.checked) {
                    document.body.classList.add('dark-mode');
                    localStorage.setItem('theme', 'dark-mode');
                }
                else {
                    document.body.classList.remove('dark-mode');
                    localStorage.setItem('theme', 'light-mode');
                }
            }

            toggleSwitch.addEventListener('change', switchTheme, false);
        });
    </script>
    {% endblock %}
</body>
</html>
