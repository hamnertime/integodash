<div class="grid-stack-item-content form-section simple-form">
    <h2>Custom Line Items</h2>
    <table class="item-table">
        <thead><tr><th>Name</th><th>Type</th><th>Amount</th><th>Billing Period</th><th>Actions</th></tr></thead>
        <tbody>
        {% for item in custom_line_items %}
            <tr>
                <td>{{ item.name }}</td>
                <td>
                    {% if item.monthly_fee is not none %}Recurring
                    {% elif item.yearly_fee is not none %}Yearly
                    {% else %}One-Off{% endif %}
                </td>
                <td>${{ "%.2f"|format(item.monthly_fee or item.one_off_fee or item.yearly_fee or 0.0) }}</td>
                <td>
                    {% if item.one_off_year %}{{ item.one_off_year }}-{{ "%02d"|format(item.one_off_month) }}
                    {% elif item.yearly_bill_month %}Every {{ "%02d"|format(item.yearly_bill_month) }}/{{ "%02d"|format(item.yearly_bill_day) }}
                    {% else %}N/A{% endif %}
                </td>
                <td>
                    <button type="button" class="icon-button edit edit-line-item"
                        data-item-id="{{ item.id }}"
                        data-name="{{ item.name }}"
                        data-monthly-fee="{{ item.monthly_fee if item.monthly_fee is not none else '' }}"
                        data-one-off-fee="{{ item.one_off_fee if item.one_off_fee is not none else '' }}"
                        data-one-off-month="{{ item.one_off_month if item.one_off_month is not none else '' }}"
                        data-one-off-year="{{ item.one_off_year if item.one_off_year is not none else '' }}"
                        data-yearly-fee="{{ item.yearly_fee if item.yearly_fee is not none else '' }}"
                        data-yearly-bill-month="{{ item.yearly_bill_month if item.yearly_bill_month is not none else '' }}"
                        data-yearly-bill-day="{{ item.yearly_bill_day if item.yearly_bill_day is not none else '' }}"
                    >
                        <svg viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25Z" /></svg>
                    </button>
                    <a href="{{ url_for('client_settings', account_number=client.account_number, delete_line_item=item.id) }}" class="icon-button delete" onclick="return confirm('Are you sure?')">
                        <svg viewBox="0 0 24 24"><path d="M9,3V4H4V6H5V19C5,20.1 5.9,21 7,21H17C18.1,21 19,20.1 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z" /></svg>
                    </a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <h3 style="margin-top: 20px;">Add New Line Item</h3>
    <form method="POST" action="{{ url_for('client_settings', account_number=client.account_number) }}">
         <div class="form-row">
            <div>
                <label for="line_item_name">Item Name:</label>
                <input type="text" id="line_item_name" name="line_item_name" required>
            </div>
            <div id="recurring_fields">
                <label for="line_item_recurring_fee">Monthly Fee:</label>
                <input type="number" id="line_item_recurring_fee" name="line_item_recurring_fee" step="0.01">
            </div>
        </div>
        <div>
            <label for="line_item_type">Item Type:</label>
            <select id="line_item_type" name="line_item_type" onchange="toggleLineItemFields(this.value)">
                <option value="recurring" selected>Recurring Monthly</option>
                <option value="one_off">One-Off Charge</option>
                <option value="yearly">Recurring Yearly</option>
            </select>
        </div>

        <div id="one_off_fields" style="display:none;">
            <label for="line_item_one_off_fee">One-Off Fee:</label>
            <input type="number" id="line_item_one_off_fee" name="line_item_one_off_fee" step="0.01">
            <label for="line_item_one_off_month">Billing Month:</label>
            <select id="line_item_one_off_month" name="line_item_one_off_month">
                {% for month in month_options %}
                    <option value="{{ month.value }}">{{ month.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div id="yearly_fields" style="display:none;">
            <label for="line_item_yearly_fee">Yearly Fee:</label>
            <input type="number" id="line_item_yearly_fee" name="line_item_yearly_fee" step="0.01">
            <label for="line_item_yearly_month">Billing Month:</label>
            <select id="line_item_yearly_month" name="line_item_yearly_month">
                {% for i in range(1, 13) %}<option value="{{ i }}">{{ i }}</option>{% endfor %}
            </select>
            <label for="line_item_yearly_day">Billing Day:</label>
            <select id="line_item_yearly_day" name="line_item_yearly_day">
                {% for i in range(1, 32) %}<option value="{{ i }}">{{ i }}</option>{% endfor %}
            </select>
        </div>

        <div class="button-container">
            <button type="submit" name="action" value="add_line_item">Add Line Item</button>
        </div>
    </form>
</div>